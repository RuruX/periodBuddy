<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>经日天气晴</title>

  <meta name="theme-color" content="#2b6de9" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <div class="wrap">

    <header class="header">
      <div class="title">
        <h1>经日天气晴</h1>
        <p class="sub">经期能量雷达｜每日建议卡片｜和 Sunnie 对话</p>
      </div>
      <div class="badge">仅供参考 · 非医疗建议</div>
    </header>

    <!-- PWA 安装提示（由 app.js 控制显示） -->
    <section class="card installCard" id="installCard" hidden>
      <div class="installRow">
        <div>
          <div class="installTitle">安装到桌面（PWA）</div>
          <div class="installSub">安装后会像 App 一样全屏打开，并支持离线访问。</div>
        </div>
        <button id="installBtn" class="installBtn">安装</button>
      </div>
    </section>

    <!-- 翻页容器：3 页（主页 -> 建议 -> 对话） -->
    <main class="pager" aria-label="翻页容器">
      <div class="pages" id="pages">

        <!-- Page 1: 主页（输入 + 雷达图） -->
        <section class="page" aria-label="主页">
          <section class="card">
            <h2>输入</h2>
            <div class="grid">
              <label>
                上次月经第一天
                <input id="lastStart" type="date" />
              </label>

              <label>
                经期持续（天，3–8）
                <input id="periodLen" type="number" min="3" max="8" value="5" />
              </label>

              <label>
                平均周期（天，28–35）
                <input id="cycleLen" type="number" min="28" max="35" value="30" />
              </label>

              <button id="btn">计算</button>
            </div>

            <div class="row">
              <div class="chartBox">
                <div class="rangeBar">
                  <div class="rangeLeft">
                    <div class="rangeTitle">能量回顾 / 预测</div>
                    <div class="rangeSub" id="rangeLabel">-</div>
                  </div>
                  <input id="dayOffset" class="slider" type="range" min="-3" max="3" value="0" step="1" />
                </div>

                <!-- 五芒星翻页按钮：去“每日建议卡片” -->
                <button id="toAdvice" class="fabStar" aria-label="翻页到每日建议卡片" title="查看每日建议">
                  ★
                </button>

                <canvas id="radar" height="320"></canvas>
                <div class="hint">说明：雷达图范围 0–100；界面不显示刻度数字与悬浮提示数字。</div>
              </div>

              <div class="meta">
                <div class="kv"><span>所选日期：</span><b id="chosenDate">-</b></div>
                <div class="kv"><span>周期第</span><b id="dayInCycle">-</b><span>天</span></div>
                <div class="kv"><span>阶段：</span><b id="phase">-</b></div>
              </div>
            </div>
          </section>
        </section>

        <!-- Page 2: 每日建议卡片 -->
        <section class="page" aria-label="每日建议">
          <section class="card">
            <div class="pageTop">
              <button class="backBtn" id="backHome1" aria-label="返回主页">← 返回</button>

              <div class="pageTopTitle">
                <h2>每日建议卡片</h2>
                <p class="sub">点击右上角 Sunnie（晴天娃娃）头像 → 翻页到对话框</p>
              </div>

              <!-- 点击头像翻到 Sunnie 对话 -->
              <button id="toChat" class="avatarBtn" aria-label="翻页到 Sunnie 对话" title="和 Sunnie 聊聊">
                <img id="sunnieAvatar" alt="Sunnie 头像（晴天娃娃）" />
              </button>
            </div>

            <div class="cards" id="adviceCards"></div>
          </section>
        </section>

        <!-- Page 3: Sunnie 对话 -->
        <section class="page" aria-label="Sunnie 对话">
          <section class="card">
            <div class="pageTop">
              <button class="backBtn" id="backAdvice" aria-label="返回建议卡片">← 返回</button>

              <div class="pageTopTitle">
                <h2>Sunnie 对话</h2>
                <p class="sub">默认本地 Mock，可在 <code>app.js</code> 配置接入真实 AI agent</p>
              </div>

              <div class="pageTopRight">
                <img class="avatarSmall" id="sunnieAvatarSmall" alt="Sunnie 头像（晴天娃娃）" />
              </div>
            </div>

            <div class="chat">
              <div id="chatLog" class="chatLog" aria-label="聊天记录"></div>

              <div class="chatBar">
                <textarea id="chatInput" rows="2" placeholder="例如：那一天适合做力量训练吗？工作怎么安排更舒服？（⌘/Ctrl + Enter 发送）"></textarea>
                <button id="chatSend">发送</button>
              </div>

              <div class="chatHint">
                接口约定示例：
                <code>POST /api/agent</code>，body: <code>{message, context}</code>，返回：<code>{reply}</code>
              </div>
            </div>
          </section>
        </section>

      </div>
    </main>

    <footer class="footer">
      <div>提示：这是网页版 App（PWA）。可安装到桌面/主屏幕；离线可用。</div>
    </footer>

  </div>

  <script src="app.js"></script>
</body>
</html>
